<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <script src="global-settings.js"></script>
        <script>
            // Decide theme before CSS is parsed to prevent flash
            (function () {
                const s = GlobalSettings.loadGlobalSettings();
                GlobalSettings.applyTheme(s.darkTheme);

                // Avoid scrollbar/status-bar flash
                const meta = document.createElement("meta");
                meta.name = "color-scheme";
                meta.content = s.darkTheme ? "dark light" : "light dark";
                document.head.appendChild(meta);
            })();
        </script>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Global Settings</title>
        <link rel="stylesheet" href="main.css" />
    </head>

    <body>
        <h2>Global Settings</h2>

        <div class="setting-toggle">
            <label for="darkThemeToggle">Enable Dark Theme</label>
            <input type="checkbox" id="darkThemeToggle" />
        </div>

        <div class="setting-toggle">
            <label for="listViewToggle">Enable List View for Games</label>
            <input type="checkbox" id="listViewToggle" />
        </div>

        <div class="setting-toggle">
            <label for="deletionConfirmationToggle">Enable Deletion Confirmation</label>
            <input type="checkbox" id="deletionConfirmationToggle" />
        </div>

        <div class="setting-toggle">
            <label for="updatesStartupToggle">Check for Xenolauncher updates on startup</label>
            <input type="checkbox" id="updatesStartupToggle" />
        </div>

        <div class="setting-toggle">
            <label for="moduleUpdatesStartupToggle">Check for module updates on startup</label>
            <input type="checkbox" id="moduleUpdatesStartupToggle" />
        </div>

        <div class="setting-toggle">
            <label for="nonInstalledAutodetectToggle">Enable Autodetect for Non-Installed Game Engines</label>
            <input type="checkbox" id="nonInstalledAutodetectToggle" />
        </div>

        <div class="footer">
            <button id="cancelButton" class="secondary-button">Cancel</button>
            <button id="saveSettings" class="primary-button">Save</button>
        </div>

        <!-- Shared scripts -->
        <script src="window-utils.js"></script>

        <!-- Page logic -->
        <script>
            const currentVersion = nw.App.manifest.version;

            const s = GlobalSettings.loadGlobalSettings();
            document.getElementById("darkThemeToggle").checked = s.darkTheme;
            document.getElementById("listViewToggle").checked = s.listView;
            document.getElementById("deletionConfirmationToggle").checked = s.deletionConfirmation;
            document.getElementById("updatesStartupToggle").checked = s.checkUpdatesOnStartup;
            document.getElementById("moduleUpdatesStartupToggle").checked = s.checkModuleUpdatesOnStartup;
            document.getElementById("nonInstalledAutodetectToggle").checked = s.nonInstalledAutodetect;

            document.getElementById("saveSettings").addEventListener("click", () => {
                const updated = {
                    darkTheme: document.getElementById("darkThemeToggle").checked,
                    listView: document.getElementById("listViewToggle").checked,
                    deletionConfirmation: document.getElementById("deletionConfirmationToggle").checked,
                    checkUpdatesOnStartup: document.getElementById("updatesStartupToggle").checked,
                    checkModuleUpdatesOnStartup: document.getElementById("moduleUpdatesStartupToggle").checked,
                    nonInstalledAutodetect: document.getElementById("nonInstalledAutodetectToggle").checked,
                    currentVersion,
                };
                GlobalSettings.saveGlobalSettings(updated);
                alert("Settings saved!");
                GlobalSettings.applyTheme(updated.darkTheme);
                window.setMainWindow(updated);
                nw.Window.get().close();
            });

            document.getElementById("cancelButton").addEventListener("click", () => nw.Window.get().close());
        </script>
    </body>
</html>
